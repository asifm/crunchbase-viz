<!-- todo: refactor python code to achieve proper format. remove redundancy in the format. include a type for companies who're both investees and investors (like didi-dache) -->
<!DOCTYPE html>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<html lang="en">
<html>

<head>
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/queue.v1.min.js">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <style>
    .label {
        fill: black;
        font-family: sans-serif;
        font-size: 16px;
        text-anchor: middle;
    }
    </style>
</head>

<body>
    <script type="text/javascript">
    /* Set the diagrams Height & Width */
    var h = 800,
        w = 1600;
    /* Set the color scale we want to use */
    var color = d3.scale.category10();
    /* Establish/instantiate an SVG container object */
    var svg = d3.select("body")
        .append("svg")
        .attr("height", h)
        .attr("width", w);

    /* Pre-Load the json data using the queue library */
    queue()
        .defer(d3.json, "nodes.json")
        .defer(d3.json, "links.json")
        .await(makeDiag);
    /* Define the main worker or execution function */
    function makeDiag(error, nodes, links, table) {

        /* Establish the dynamic force behavor of the nodes */
        var force = d3.layout.force()
            .nodes(nodes)
            .links(links)
            .size([w, h])
            .linkDistance([30])
            .charge([-200])
            .gravity(0.1)
            .start();

        /* Draw the edges/links between the nodes */
        var edges = svg.selectAll("line")
            .data(links)
            .enter()
            .append("line")
            .style("stroke", "#ccc")
            .style("stroke-width", 1)

        /* Draw the nodes themselves */
        var nodes = svg.selectAll("circle")
            .data(nodes)
            .enter()
            .append("circle")
            .attr("r", 5)
            .attr("opacity", 1)
            .style("fill", function(d) {
                return color(d.type);
            })
            .on("dblclick", function(d) {
                window.open("https://www.crunchbase.com/organization/" + d.name);
            })
            .on("mouseenter", function(d) {
                nodes.transition().attr("opacity", 0.3);
                console.log(this);
                var node = d3.select(this).classed("selected-node", true);
                node.transition().attr("opacity", 1).attr("r", 9);
                svg.insert("text", ".selected-node").text(d.name).attr("x", d.x).attr("y", d.y - 25).attr("class", "label");
            })
            .on("mouseleave", function() {
                var node = d3.select(this);
                node.attr("opacity", 1).attr("r", 5).classed("selected-node", false);
                d3.selectAll(".label").transition().remove();
                nodes.transition().attr("opacity", 1);
            })
            .call(force.drag);
        /* Run the Force effect */
        force.on("tick", function() {
            edges.attr("x1", function(d) {
                    return d.source.x;
                })
                .attr("y1", function(d) {
                    return d.source.y;
                })
                .attr("x2", function(d) {
                    return d.target.x;
                })
                .attr("y2", function(d) {
                    return d.target.y;
                });
            nodes.attr("cx", function(d) {
                    return d.x;
                })
                .attr("cy", function(d) {
                    return d.y;
                })

        }); // End tick func
    }; // End makeDiag worker func
    </script>
</body>

</html>
